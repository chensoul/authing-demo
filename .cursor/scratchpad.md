
# 背景和动机
用户希望实现一个类似 Auth0/Authing 的身份认证与授权系统，目标是为应用提供安全、灵活的用户身份管理、权限控制和第三方登录等能力。

# 需求文档
## 0. 用户池（UserPool）隔离
- 支持多用户池，每个用户池下有独立的用户、应用、租户、权限等数据
- 用户池之间完全隔离，数据互不影响
- 用户、应用、租户、权限等均归属于某个用户池
- 用户池可配置（如登录方式、密码策略、第三方登录等）
- 用户池类型（type）：B2C、B2B、B2E
  - B2C：面向个人用户，支持自注册、社交登录等
  - B2B：面向企业/组织，支持企业管理员、成员管理、企业 SSO 等
    - B2B 支持三种运营模式：
      - 自运营：企业客户自主管理本企业的用户、组织、权限等。当前租户只能管理本租户的用户、组织、机构、角色、权限等，不能越权管理其他租户的数据。
      - 代运营：平台方为企业客户代为管理用户、组织、权限等。当前租户除了可以管理本租户的数据，也可以跨租户管理其他租户的用户、组织、机构、角色、权限等。
      - 混合运营：企业客户和平台方均可管理，权限可配置
  - B2E：面向企业员工，通常与企业内部系统集成
- 用户池类型影响注册、认证、权限、租户等策略和功能
- 默认数据库为 MySQL，所有数据模型和接口均基于 MySQL 设计
- MySQL、Redis 等基础服务均通过 docker-compose 管理

## 1. 用户身份认证
- 支持用户名/密码注册与登录
- 支持第三方登录（如微信、钉钉、Google、GitHub 等）
- 支持多因子认证（MFA）
- 支持找回密码、重置密码
- 支持用户信息管理（昵称、头像、邮箱、手机号等）

## 2. 授权与权限管理
- 支持基于角色的访问控制（RBAC）
- 支持自定义权限粒度
- 支持租户（多组织/多企业）隔离
- 支持应用与权限的绑定

## 3. 安全与审计
- 登录、操作日志审计
- 支持安全策略（如密码强度、登录限制、IP 白名单等）

## 4. 开发者集成
- 提供标准 OAuth2/OpenID Connect 协议支持
- 提供 RESTful API
- 提供 SDK 示例

# 开发文档

## 任务拆分

### 环境搭建
- [ ] 1.1 编写 docker-compose.yml，配置 MySQL 服务（后续可扩展 Redis）

### 项目初始化
- [ ] 2.1 使用 Spring Boot CLI 创建 Spring Boot 3 + Maven + MySQL 基础项目（包含 MySQL 依赖和 application.yml 示例配置）

### 功能开发
- [ ] 3.1 设计用户池（UserPool）及其类型（B2C/B2B/B2E）与用户、应用、租户、权限的关系模型
  - [ ] 3.1.1 支持 B2B 用户池的自运营、代运营、混合运营模式建模与接口
    - [ ] 3.1.1.1 自运营模式下租户权限隔离建模与接口（当前租户只能管理本租户的数据）
    - [ ] 3.1.1.2 代运营模式下跨租户管理权限建模与接口（当前租户可管理所有租户的数据）
- [ ] 3.2 设计用户、角色、权限、租户等核心数据模型
- [ ] 3.3 实现基础的用户注册、登录、登出接口
- [ ] 3.4 实现第三方登录（以钉钉为例）
- [ ] 3.5 实现角色与权限管理接口
- [ ] 3.6 实现租户隔离与多租户支持
- [ ] 3.7 实现操作与登录日志审计
- [ ] 3.8 支持 OAuth2/OpenID Connect 协议
- [ ] 3.9 提供 API 文档与 SDK 示例

## 项目状态看板
- [ ] 需求分析与模型设计
- [ ] 环境搭建
- [ ] Spring Boot + MySQL 项目初始化
- [ ] 用户池与隔离机制
- [ ] 用户注册/登录/登出
- [ ] 第三方登录（钉钉）
- [ ] 角色与权限管理
- [ ] 多租户支持
- [ ] 日志审计
- [ ] OAuth2/OIDC 支持
- [ ] API 文档/SDK

## 执行者反馈或请求帮助
（此处由执行者在开发过程中补充）

## 经验教训
（遇到问题和解决方案在此记录）