# 背景和动机
用户希望实现一个类似 Auth0/Authing 的身份认证与授权系统，目标是为应用提供安全、灵活的用户身份管理、权限控制和第三方登录等能力。

# 需求文档
## 0. 用户池（UserPool）隔离
- 支持多用户池，每个用户池下有独立的用户、应用、租户、权限等数据
- 用户池之间完全隔离，数据互不影响
- 用户、应用、租户、权限等均归属于某个用户池
- 用户池可配置（如登录方式、密码策略、第三方登录等）
- 用户池类型（type）：B2C、B2B、B2E
  - B2C：面向个人用户，支持自注册、社交登录等
  - B2B：面向企业/组织，支持企业管理员、成员管理、企业 SSO 等
    - B2B 支持三种运营模式：
      - 自运营：企业客户自主管理本企业的用户、组织、权限等。当前租户只能管理本租户的用户、组织、机构、角色、权限等，不能越权管理其他租户的数据。
      - 代运营：平台方为企业客户代为管理用户、组织、权限等。当前租户除了可以管理本租户的数据，也可以跨租户管理其他租户的用户、组织、机构、角色、权限等。
      - 混合运营：企业客户和平台方均可管理，权限可配置
  - B2E：面向企业员工，通常与企业内部系统集成
- 用户池类型影响注册、认证、权限、租户等策略和功能
- 默认数据库为 MySQL，所有数据模型和接口均基于 MySQL 设计
- MySQL、Redis 等基础服务均通过 docker-compose 管理

## 1. 用户身份认证
- 支持用户名/密码注册与登录
- 支持第三方登录（如微信、钉钉、Google、GitHub 等）
- 支持多因子认证（MFA）
- 支持找回密码、重置密码
- 支持用户信息管理（昵称、头像、邮箱、手机号等）

## 2. 授权与权限管理
- 支持基于角色的访问控制（RBAC）
- 支持自定义权限粒度
- 支持租户（多组织/多企业）隔离
- 支持应用与权限的绑定

## 3. 安全与审计
- 登录、操作日志审计
- 支持安全策略（如密码强度、登录限制、IP 白名单等）

## 4. 开发者集成
- 提供标准 OAuth2/OpenID Connect 协议支持
- 提供 RESTful API
- 提供 SDK 示例

# 开发文档

## 任务拆分

### 技术选型
1.1 明确技术栈（Spring Boot 3、Maven、MySQL、Redis、Spring Security、JPA 等）
  - 成功标准：所有核心依赖和技术路线在文档中有说明，团队成员无异议。
1.2 设计基础分层结构和代码规范
  - 成功标准：有分层结构图和主要规范说明，团队成员认可。

### 项目初始化
2.1 编写 docker-compose.yml，配置 MySQL 服务（后续可扩展 Redis）
  - 成功标准：本地可通过 docker-compose 一键启动 MySQL，能通过客户端连接。
2.2 使用 Spring Boot CLI 创建 Spring Boot 3 + Maven + MySQL 基础项目（包含 MySQL 依赖和 application.yml 示例配置）
  - 成功标准：项目可编译启动，能连接 docker-compose 启动的 MySQL，application.yml 配置清晰，含示例。

### 功能开发
3.1 设计用户池（UserPool）及其类型（B2C/B2B/B2E）与用户、应用、租户、权限的关系模型
  - 成功标准：ER 图/类图清晰，核心实体类和表结构定义合理，支持多用户池隔离。
  3.1.1 支持 B2B 用户池的自运营、代运营、混合运营模式建模与接口
    3.1.1.1 自运营模式下租户权限隔离建模与接口（当前租户只能管理本租户的数据）
      - 成功标准：接口和权限校验逻辑能严格限制租户仅操作本租户数据。
    3.1.1.2 代运营模式下跨租户管理权限建模与接口（当前租户可管理所有租户的数据）
      - 成功标准：接口和权限校验逻辑能支持跨租户管理，且有审计日志。
3.2 设计用户、角色、权限、租户等核心数据模型
  - 成功标准：模型设计满足 RBAC、租户隔离、权限扩展性。
3.3 实现基础的用户注册、登录、登出接口
  - 成功标准：接口通过单元测试，支持用户名/密码注册、登录、登出。
3.4 实现第三方登录（以钉钉为例）
  - 成功标准：可用钉钉扫码登录，能获取用户基本信息。
3.5 实现角色与权限管理接口
  - 成功标准：支持角色分配、权限分配、接口权限校验。
3.6 实现租户隔离与多租户支持
  - 成功标准：不同租户数据物理/逻辑隔离，接口有租户上下文校验。
3.7 实现操作与登录日志审计
  - 成功标准：所有关键操作和登录事件有日志记录，支持查询。
3.8 支持 OAuth2/OpenID Connect 协议
  - 成功标准：实现标准 OAuth2/OIDC 授权码流程，能对接第三方应用。
3.9 提供 API 文档与 SDK 示例
  - 成功标准：Swagger/OpenAPI 文档齐全，提供 Java/前端 SDK 示例。

### 上线部署
4.1 编写生产环境 docker-compose.yml，支持 MySQL、Redis、Spring Boot 服务一键部署
  - 成功标准：生产环境可一键启动所有服务，配置安全、端口规范。
4.2 编写部署/运维文档
  - 成功标准：有详细部署步骤、环境变量说明、常见问题处理，非开发人员可独立完成部署。

## 项目状态看板
- [ ] 1.1 明确技术栈（Spring Boot 3、Maven、MySQL、Redis、Spring Security、JPA 等）
- [ ] 1.2 设计基础分层结构和代码规范
- [ ] 2.1 编写 docker-compose.yml，配置 MySQL 服务（后续可扩展 Redis）
- [ ] 2.2 使用 Spring Boot CLI 创建 Spring Boot 3 + Maven + MySQL 基础项目（包含 MySQL 依赖和 application.yml 示例配置）
- [ ] 3.1 设计用户池（UserPool）及其类型（B2C/B2B/B2E）与用户、应用、租户、权限的关系模型
- [ ] 3.1.1 支持 B2B 用户池的自运营、代运营、混合运营模式建模与接口
- [ ] 3.1.1.1 自运营模式下租户权限隔离建模与接口（当前租户只能管理本租户的数据）
- [ ] 3.1.1.2 代运营模式下跨租户管理权限建模与接口（当前租户可管理所有租户的数据）
- [ ] 3.2 设计用户、角色、权限、租户等核心数据模型
- [ ] 3.3 实现基础的用户注册、登录、登出接口
- [ ] 3.4 实现第三方登录（以钉钉为例）
- [ ] 3.5 实现角色与权限管理接口
- [ ] 3.6 实现租户隔离与多租户支持
- [ ] 3.7 实现操作与登录日志审计
- [ ] 3.8 支持 OAuth2/OpenID Connect 协议
- [ ] 3.9 提供 API 文档与 SDK 示例
- [ ] 4.1 编写生产环境 docker-compose.yml，支持 MySQL、Redis、Spring Boot 服务一键部署
- [ ] 4.2 编写部署/运维文档

## 执行者反馈或请求帮助
（此处由执行者在开发过程中补充）

## 经验教训
（遇到问题和解决方案在此记录）